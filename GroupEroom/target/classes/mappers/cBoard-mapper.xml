<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >


<mapper namespace="cBoardMapper">
	<resultMap type="cBoard" id="cBoardResultMap">
		<id property="cBoardNo" column="C_BOARD_NO"></id>
		<result property="memberId" column="MEMBER_ID"></result>
		<result property="memberName" column="MEMBER_NAME"></result>
		<result property="cBoardTitle" column="C_BOARD_TITLE"></result>
		<result property="cBoardContents" column="C_BOARD_CONTENTS"></result>
		<result property="enrollDate" column="ENROLL_DATE"></result>
		<result property="hits" column="HITS"></result>
		<result property="originalFile" column="ORIGINAL_FILE"></result>
		<result property="renameFile" column="RENAME_FILE"></result>
	</resultMap>

	
	<select id="selectListCount" resultType="_int"> 
		SELECT COUNT(*) FROM CLUBBOARD
	</select>
	
	<select id="selectAllList" resultMap="cBoardResultMap"> 
		SELECT C_BOARD_NO, MEMBER_ID, MEMBER_NAME, C_BOARD_TITLE, C_BOARD_CONTENTS, ENROLL_DATE, HITS
		FROM CLUBBOARD JOIN MEMBER USING(MEMBER_ID) ORDER BY C_BOARD_NO DESC
	</select>
	
	<select id="selectSearchList" resultMap="cBoardResultMap">
		SELECT C_BOARD_NO, MEMBER_NAME, C_BOARD_TITLE, C_BOARD_CONTENTS, ENROLL_DATE
		FROM CLUBBOARD JOIN MEMBER USING(MEMBER_ID)
			<if test="searchCondition.toString() == 'ALL'"> WHERE MEMBER_NAME LIKE '%' || #{searchValue } || '%' OR C_BOARD_TITLE LIKE '%' || #{searchValue } || '%' OR C_BOARD_CONTENTS LIKE '%' || #{searchValue } || '%' </if>
			<if test="searchCondition.toString() != 'ALL'"> WHERE ${searchCondition} LIKE '%' || #{searchValue } || '%'</if>
		 ORDER BY C_BOARD_NO DESC
	</select>
	
	<select id="selectSearchListCount" resultType="_int">
		SELECT COUNT(*) FROM CLUBBOARD JOIN MEMBER USING(MEMBER_ID)
			<if test="searchCondition.toString() == 'ALL'"> WHERE MEMBER_NAME LIKE '%' || #{searchValue } || '%' OR C_BOARD_TITLE LIKE '%' || #{searchValue } || '%' OR C_BOARD_CONTENTS LIKE '%' || #{searchValue } || '%' </if>
			<if test="searchCondition.toString() != 'ALL'"> WHERE ${searchCondition} LIKE '%' || #{searchValue } || '%'</if>
		 ORDER BY C_BOARD_NO DESC
	</select>
	
	<select id="selectOne" resultMap="cBoardResultMap" parameterType="_int">
		SELECT C_BOARD_NO, MEMBER_ID, MEMBER_NAME, C_BOARD_TITLE, C_BOARD_CONTENTS, ENROLL_DATE, HITS
		FROM CLUBBOARD JOIN MEMBER USING(MEMBER_ID) 
		WHERE C_BOARD_NO = #{cBoardNo}
		ORDER BY C_BOARD_NO DESC
	</select>
	
	<update id="updateCount">
		UPDATE CLUBBOARD SET HITS = HITS + 1 WHERE C_BOARD_NO = #{boardNo}
	</update>
</mapper>